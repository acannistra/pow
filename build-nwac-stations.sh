#!/bin/bash

curl "https://api.snowobs.com/wx/v1/station/data/timeseries/?source=nwac&token=71ad26d7aaf410e39efe91bd414d32e1db5d&stid=$(echo {1..100} | tr ' ' ,)&start_date=$(gdate +%Y%m%d%H%M)&end_date=$(gdate +%Y%m%d%H%M -d "+1 day")" | jq '.STATION | sort_by(.NAME)[] | select((.observations | length) > 0 and .observations.snow_depth[0] != null) | {name: .name, lat: .latitude, lon: .longitude, elevation: .elevation, nwac_id: .stid, url: @uri "https://api.snowobs.com/wx/v1/station/data/timeseries/?token=71ad26d7aaf410e39efe91bd414d32e1db5d&stid=\(.stid)&source=nwac"}' | jq '.' -s >stations.json
